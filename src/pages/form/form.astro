---
const handleSubmit = async (event) => {
  event.preventDefault(); // ここでページリロードを防ぐ

  const form = event.target;

  const data = {
    name: form.name.value,
    email: form.email.value,
    type: form.type ? form.type.value : "HP問い合わせ", // type があれば取得
    message: form.message.value
  };

  try {
    const res = await fetch('/api/contact', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json; charset=UTF-8' },
      body: JSON.stringify(data)
    });

    // サーバーが JSON を返していなければここでエラーになる
    const result = await res.json();

    if (res.ok) {
      alert(result.message || '送信成功！');
      form.reset();
    } else {
      alert(result.message || '送信に失敗しました');
    }
  } catch (err) {
    console.error(err);
    alert('送信中にエラーが発生しました');
  }
};
---

<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>お問い合わせフォーム</title>
  </head>
  <body>
    <h1>お問い合わせフォーム</h1>
    <form id="contactForm" on:submit={handleSubmit}>
      <label>
        名前 (必須)
        <input type="text" name="name" required>
      </label>
      <br>
      <label>
        メール (必須)
        <input type="email" name="email" required>
      </label>
      <br>
      <label>
        種別 (必須)
        <select name="type" required>
          <option value="HP問い合わせ">HP問い合わせ</option>
          <option value="資料請求">資料請求</option>
        </select>
      </label>
      <br>
      <label>
        メッセージ (必須)
        <textarea name="message" required></textarea>
      </label>
      <br>
      <button type="submit">送信</button>
    </form>
  </body>
</html>
